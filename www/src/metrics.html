<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康指标记录</title>
    <link rel="stylesheet" href="../statics/css/metrics.css">
    <link rel="icon" href="../images/writing.png" type="image/png">
</head>
<body>
    <!-- 顶部图标 -->
    <div style="position: absolute; top: 15px; left: 15px; z-index: 10;">
        <img src="../images/writing.png" alt="Writing" style="height: 50px" />
    </div>

    <!-- 返回按钮 -->
    <div class="back-button-container">
        <button class="back-btn" onclick="goBack()">
            <span>← 返回</span>
        </button>
    </div>

    <!-- 页面标题 -->
    <div class="page-title">
        健康指标记录
    </div>

    <!-- 记录日期与时间 -->
    <div class="record-controls">
        <div class="date-time-picker">
            <div class="picker-group">
                <label for="record-date-input" class="picker-label">📅 记录日期</label>
                <input type="date" id="record-date-input" class="picker-input" />
            </div>
            <div class="picker-group">
                <label for="record-time-input" class="picker-label">🕐 记录时间</label>
                <input type="time" id="record-time-input" class="picker-input" step="1" />
            </div>
        </div>
    </div>

    <!-- 指标容器 -->
    <div class="metrics-container">
        <!-- 症状记录 -->
        <div class="metric-card" data-type="symptoms">
            <div class="metric-icon">
                <div class="icon-placeholder">🤒</div>
            </div>
            <div class="metric-content">
                <h3 class="metric-title">症状</h3>
                <p class="metric-description">记录身体不适症状</p>
                <div class="metric-input">
                    <textarea id="symptoms-input" placeholder="描述您的症状..." rows="3"></textarea>
                </div>
            </div>

        </div>

        <!-- 体温记录 -->
        <div class="metric-card" data-type="temperature">
            <div class="metric-icon">
                <div class="icon-placeholder">🌡️</div>
            </div>
            <div class="metric-content">
                <h3 class="metric-title">体温</h3>
                <p class="metric-description">记录体温数值</p>
                <div class="metric-input">
                    <div class="input-group">
                        <input type="number" id="temperature-input" step="0.1" min="35" max="45" placeholder="36.5">
                        <span class="unit">°C</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- 24h尿蛋白测定 -->
        <div class="metric-card" data-type="proteinuria">
            <div class="metric-icon">
                <div class="icon-placeholder">🕐</div>
            </div>
            <div class="metric-content">
                <h3 class="metric-title">24h尿蛋白测定</h3>
                <p class="metric-description">24小时尿蛋白含量</p>
                <div class="metric-input">
                    <div class="input-group">
                        <input type="number" id="proteinuria-input" step="0.1" min="0" placeholder="0.0">
                        <span class="unit">g/24h</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- 血常规检测指标矩阵 -->
        <div class="metric-card" data-type="blood-test-matrix">
            <div class="metric-icon">
                <div class="icon-placeholder">🩸</div>
            </div>
            <div class="metric-content">
                <h3 class="metric-title">血常规</h3>
                <p class="metric-description">选择并填写血常规检测项目</p>
                <div class="metric-input">
                    <div id="blood-test-matrix-container" class="blood-test-matrix">
                        <div class="blood-test-item">
                            <div class="item-header">
                                <select class="blood-test-select" data-index="0">
                                    <option value="">请选择检测项目</option>
                                    <!-- 白细胞相关 -->
                                    <option value="wbc-count" data-unit="×10⁹/L" data-reference="4-10">白细胞计数</option>
                                    <option value="neutrophils-abs" data-unit="×10⁹/L" data-reference="2-7.5">中性粒细胞(绝对值)</option>
                                    <option value="lymphocytes-abs" data-unit="×10⁹/L" data-reference="0.8-4">淋巴细胞(绝对值)</option>
                                    <option value="monocytes-abs" data-unit="×10⁹/L" data-reference="0.16-1.2">单核细胞(绝对值)</option>
                                    <option value="eosinophils-abs" data-unit="×10⁹/L" data-reference="0.02-0.5">嗜酸性粒细胞(绝对值)</option>
                                    <option value="basophils-abs" data-unit="×10⁹/L" data-reference="0-0.1">嗜碱性粒细胞(绝对值)</option>
                                    <option value="neutrophils-percent" data-unit="%" data-reference="50-75">中性粒细胞(百分比)</option>
                                    <option value="lymphocytes-percent" data-unit="%" data-reference="20-40">淋巴细胞(百分比)</option>
                                    <option value="monocytes-percent" data-unit="%" data-reference="4-12">单核细胞(百分比)</option>
                                    <option value="eosinophils-percent" data-unit="%" data-reference="0.5-5">嗜酸性粒细胞(百分比)</option>
                                    <option value="basophils-percent" data-unit="%" data-reference="0-1">嗜碱性粒细胞(百分比)</option>
                                    <!-- 红细胞相关 -->
                                    <option value="rbc-count" data-unit="×10¹²/L" data-reference="3.5-5.5">红细胞计数</option>
                                    <option value="hemoglobin" data-unit="g/L" data-reference="110-160">血红蛋白</option>
                                    <option value="hematocrit" data-unit="%" data-reference="37-49">红细胞压积</option>
                                    <option value="mcv" data-unit="fL" data-reference="82-95">平均红细胞体积</option>
                                    <option value="mch" data-unit="pg" data-reference="27-31">平均红细胞血红蛋白量</option>
                                    <option value="mchc" data-unit="g/L" data-reference="320-360">平均红细胞血红蛋白浓度</option>
                                    <option value="rdw-sd" data-unit="fL" data-reference="37-54">红细胞分布宽度(SD)</option>
                                    <option value="rdw-cv" data-unit="%" data-reference="11-16">红细胞分布宽度(CV)</option>
                                    <!-- 血小板相关 -->
                                    <option value="platelet-count" data-unit="×10⁹/L" data-reference="100-300">血小板计数</option>
                                    <option value="pdw" data-unit="fL" data-reference="9-17">血小板分布宽度</option>
                                    <option value="mpv" data-unit="fL" data-reference="9.4-12.5">平均血小板体积</option>
                                    <option value="pct" data-unit="%" data-reference="0.11-0.27">血小板压积</option>
                                    <option value="p-lcr" data-unit="%" data-reference="13-43">大型血小板比率</option>
                                    <option value="custom" data-unit="" data-reference="">自定义项目</option>
                                </select>
                                <button type="button" class="remove-btn" onclick="removeBloodTestItem(this)" style="display: none;" onmousedown="try { window.__hapticImpact__ && window.__hapticImpact__('Light'); } catch(_) {}">×</button>
                            </div>
                            <div class="custom-input-wrapper" style="display: none;">
                                <input type="text" class="custom-blood-test-name" placeholder="请输入自定义项目名称" data-index="0">
                            </div>
                            <div class="item-input">
                                <input type="text" class="blood-test-value" placeholder="请输入数值" data-index="0">
                                <div class="unit-reference">
                                    <span class="unit-display">单位</span>
                                    <span class="reference-display">参考值</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-btn" onclick="addBloodTestItem()" onmousedown="try { window.__hapticImpact__ && window.__hapticImpact__('Light'); } catch(_) {}">
                        <span class="add-icon">＋</span>
                        <span class="add-text">添加检测项目</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 出血点记录 -->
        <div class="metric-card" data-type="bleeding-point">
            <div class="metric-icon">
                <div class="icon-placeholder">🩹</div>
            </div>
            <div class="metric-content">
                <h3 class="metric-title">出血点</h3>
                <p class="metric-description">记录身体出血部位</p>
                <div class="metric-input">
                    <div class="bleeding-points-container">
                        <div id="bleeding-points-list" class="bleeding-points-list">
                            <!-- 出血点项目将动态添加到这里 -->
                        </div>
                        <button type="button" class="add-bleeding-point-btn" onclick="addBleedingPoint()">
                            <span class="add-icon">＋</span>
                            <span class="add-text">添加出血点</span>
                        </button>
                    </div>
                    
                    <!-- 图片上传区域 -->
                    <div class="image-upload-section">
                        <h4 class="upload-title">上传图片</h4>
                        <div class="image-upload-container">
                            <div class="image-upload-btn" id="bleedingImageUploadBtn">
                                <div class="upload-icon">+</div>
                                <div class="upload-text">(上传图片)</div>
                            </div>
                            <input type="file" id="bleedingImageInput" accept="image/*" multiple style="display: none;">
                            <div class="uploaded-images" id="bleedingUploadedImages"></div>
                        </div>
                        <!-- JSON大小显示 -->
                        <div id="json-size-display"></div>
                    </div>
                </div>
            </div>

        </div>

        <!-- 尿液检测指标矩阵 -->
        <div class="metric-card" data-type="urinalysis-matrix">
            <div class="metric-icon">
                <div class="icon-placeholder">🧪</div>
            </div>
            <div class="metric-content">
                <h3 class="metric-title">尿常规</h3>
                <p class="metric-description">选择并填写尿液检测项目</p>
                <div class="metric-input">
                    <div id="urinalysis-matrix-container" class="urinalysis-matrix">
                        <div class="urinalysis-item">
                            <div class="item-header">
                                <select class="urinalysis-select" data-index="0">
                                    <option value="">请选择检测项目</option>
                                    <option value="ph" data-unit="" data-reference="5.0-8.0">pH</option>
                                    <option value="color" data-unit="" data-reference="颜色">颜色</option>
                                    <option value="nitrite" data-unit="" data-reference="阴性">亚硝酸盐</option>
                                    <option value="glucose" data-unit="" data-reference="阴性">葡萄糖</option>
                                    <option value="specific-gravity" data-unit="" data-reference="1.005-1.030">比重</option>
                                    <option value="occult-blood" data-unit="" data-reference="阴性">隐血</option>
                                    <option value="protein" data-unit="" data-reference="阴性">蛋白质</option>
                                    <option value="bilirubin" data-unit="" data-reference="阴性">胆红素</option>
                                    <option value="leukocyte-esterase" data-unit="" data-reference="阴性">白细胞酯酶</option>
                                    <option value="rbc-count" data-unit="/μl" data-reference="0-17.0">红细胞（定量）</option>
                                    <option value="wbc-count" data-unit="/μl" data-reference="0-28.0">白细胞（定量）</option>
                                    <option value="hyaline-casts" data-unit="/μl" data-reference="0-1">透明管型</option>
                                    <option value="conductivity" data-unit="mS/cm" data-reference="5-32">电导率</option>
                                    <option value="crystals" data-unit="/μl" data-reference="">结晶</option>
                                    <option value="osmolality" data-unit="mOsm/kgH2O" data-reference="40-1400">渗透压</option>
                                    <option value="mucus" data-unit="/μl" data-reference="0-46">粘液丝</option>
                                    <option value="squamous-epithelial" data-unit="/μl" data-reference="0-28">鳞状上皮细胞</option>
                                    <option value="nonsquamous-epithelial" data-unit="/μl" data-reference="0-6">非鳞状上皮细胞</option>
                                    <option value="wbc-clumps" data-unit="/μl" data-reference="0-2.0">白细胞团</option>
                                    <option value="urine-creatinine" data-unit="g/L" data-reference="0.1-2.0">尿肌酐</option>
                                    <option value="up-cr" data-unit="mg/gCr" data-reference="0-30">尿白蛋白/尿肌酐</option>
                                    <option value="vitamin-c" data-unit="" data-reference="阴性">维生素C</option>
                                    <option value="urine-rbc" data-unit="/μl" data-reference="0.0-30.7">尿红细胞计数</option>
                                    <option value="urine-wbc" data-unit="/μl" data-reference="0.0-39.0">尿白细胞计数</option>
                                    <option value="urine-epithelial" data-unit="/μl" data-reference="0.0-45.6">尿上皮细胞计数</option>
                                    <option value="custom" data-unit="" data-reference="">自定义项目</option>
                                </select>
                                <button type="button" class="remove-btn" onclick="removeUrinalysisItem(this)" style="display: none;" onmousedown="try { window.__hapticImpact__ && window.__hapticImpact__('Light'); } catch(_) {}">×</button>
                            </div>
                            <div class="custom-input-wrapper" style="display: none;">
                                <input type="text" class="custom-urinalysis-name" placeholder="请输入自定义项目名称" data-index="0">
                            </div>
                            <div class="item-input">
                                <input type="text" class="urinalysis-value" placeholder="请输入数值" data-index="0">
                                <div class="unit-reference">
                                    <span class="unit-display">单位</span>
                                    <span class="reference-display">参考值</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-btn" onclick="addUrinalysisItem()" onmousedown="try { window.__hapticImpact__ && window.__hapticImpact__('Light'); } catch(_) {}">
                        <span class="add-icon">＋</span>
                        <span class="add-text">添加检测项目</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 自我评分 -->
        <div class="metric-card" data-type="self-rating">
            <div class="metric-icon">
                <div class="icon-placeholder">⭐</div>
            </div>
            <div class="metric-content">
                <h3 class="metric-title">自我评分</h3>
                <p class="metric-description">请根据您当前的整体状况进行评分（0-10分）</p>
                <div class="metric-input">
                    <div class="rating-container">
                        <div class="rating-labels">
                            <span class="rating-label">0</span>
                            <span class="rating-label">5</span>
                            <span class="rating-label">10</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="self-rating-slider" class="rating-slider" min="0" max="10" step="1" value="5">
                            <div class="slider-track"></div>
                            <div class="slider-fill" id="slider-fill"></div>
                        </div>
                        <div class="rating-display">
                            <span class="rating-value" id="rating-value">5</span>
                            <span class="rating-unit">分</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- 统一保存按钮 -->
    <div class="global-actions">
        <button class="global-save-btn" onclick="saveAllMetrics()">
            <span class="btn-text">保存所有指标</span>
            <div class="loading-spinner" id="global-spinner"></div>
        </button>
    </div>

    <!-- 加载脚本 -->
    <script src="../statics/js/camera-utils.js"></script>
    <script src="../statics/js/metrics.js"></script>
</body>
</html>
